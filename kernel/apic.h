#ifndef QO3_KERNEL_APIC_H
#define QO3_KERNEL_APIC_H

#define LAPIC_BASE		0xfee00000
#define LAPIC_ID		(LAPIC_BASE+0x0020)
#define LAPIC_VERSION		(LAPIC_BASE+0x0030)
#define LAPIC_TPR		(LAPIC_BASE+0x0080)
#define LAPIC_APR		(LAPIC_BASE+0x0090)
#define LAPIC_PPR		(LAPIC_BASE+0x00A0)
#define LAPIC_EOI		(LAPIC_BASE+0x00B0)
#define LAPIC_LOGDEST		(LAPIC_BASE+0x00D0)
#define LAPIC_DESTFORMAT	(LAPIC_BASE+0x00E0)
#define LAPIC_SVR		(LAPIC_BASE+0x00F0)

#define LAPIC_ISR0		(LAPIC_BASE+0x0100)
#define LAPIC_ISR1		(LAPIC_BASE+0x0110)
#define LAPIC_ISR2		(LAPIC_BASE+0x0120)
#define LAPIC_ISR3		(LAPIC_BASE+0x0130)
#define LAPIC_ISR4		(LAPIC_BASE+0x0140)
#define LAPIC_ISR5		(LAPIC_BASE+0x0150)
#define LAPIC_ISR6		(LAPIC_BASE+0x0160)
#define LAPIC_ISR7		(LAPIC_BASE+0x0170)

#define LAPIC_TMR0		(LAPIC_BASE+0x0180)
#define LAPIC_TMR1		(LAPIC_BASE+0x0190)
#define LAPIC_TMR2		(LAPIC_BASE+0x01a0)
#define LAPIC_TMR3		(LAPIC_BASE+0x01b0)
#define LAPIC_TMR4		(LAPIC_BASE+0x01c0)
#define LAPIC_TMR5		(LAPIC_BASE+0x01d0)
#define LAPIC_TMR6		(LAPIC_BASE+0x01e0)
#define LAPIC_TMR7		(LAPIC_BASE+0x01f0)

#define LAPIC_IRR0		(LAPIC_BASE+0x0200)
#define LAPIC_IRR1		(LAPIC_BASE+0x0210)
#define LAPIC_IRR2		(LAPIC_BASE+0x0220)
#define LAPIC_IRR3		(LAPIC_BASE+0x0230)
#define LAPIC_IRR4		(LAPIC_BASE+0x0240)
#define LAPIC_IRR5		(LAPIC_BASE+0x0250)
#define LAPIC_IRR6		(LAPIC_BASE+0x0260)
#define LAPIC_IRR7		(LAPIC_BASE+0x0270)

#define LAPIC_ERROR_STATUS	(LAPIC_BASE+0x0280)
#define LAPIC_LVT_CMCI		(LAPIC_BASE+0x2f0)

#define LAPIC_ICR0		(LAPIC_BASE+0x300)
#define LAPIC_ICR1		(LAPIC_BASE+0x310)

#define LAPIC_LVT_TIMER		(LAPIC_BASE+0x320)
#define LAPIC_LVT_THERMAL	(LAPIC_BASE+0x330)
#define LAPIC_LVT_PMC		(LAPIC_BASE+0x340)
#define LAPIC_LVT_LINT0		(LAPIC_BASE+0x350)
#define LAPIC_LVT1		(LAPIC_LVT_LINT0)
#define LAPIC_LVT_LINT1		(LAPIC_BASE+0x360)
#define LAPIC_LVT2		(LAPIC_LVT_LINT1)
#define LAPIC_LVT_ERROR		(LAPIC_BASE+0x370)
#define LAPIC_LVT3		(LAPIC_LVT_ERROR)
#define LAPIC_INITIAL_COUNT 	(LAPIC_BASE+0x380)
#define LAPIC_CURRENT_COUNT 	(LAPIC_BASE+0x390)
#define LAPIC_DIVIDE		(LAPIC_BASE+0x3e0)

#define LAPIC_SVR_EOI_BROADCAST_DISABLE (1<<11)
#define LAPIC_SVR_APIC_ENABLE 	(1<<8)

#define read_local_apic(reg) (*((const unsigned int*)(reg)))
#define write_local_apic(reg, val) ((*((unsigned int*)(reg))) = (val))

#define LAPIC_MASK (1<<16)
#define LAPIC_UNMASK (0)

#define LAPIC_TIMER_MODE_ONE_SHOT (0<<17)
#define LAPIC_TIMER_MODE_PERIODIC (1<<17)
#define LAPIC_DIVIDE_2 0
#define LAPIC_DIVIDE_4 1
#define LAPIC_DIVIDE_8 2
#define LAPIC_DIVIDE_16 3
#define LAPIC_DIVIDE_32 8
#define LAPIC_DIVIDE_64 9
#define LAPIC_DIVIDE_128 10
#define LAPIC_DIVIDE_1 11

#endif
